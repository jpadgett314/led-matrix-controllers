<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FPS Counter Example</title>
    <script type="importmap">
        {
            "imports": {
                "led-matrix-controllers": "https://esm.sh/led-matrix-controllers@latest"
            }
        }
    </script>
</head>
<body>
    <h1>FPS Counter Example</h1>
    <h1 id="fps">FPS=0</h1>
    <button id="connect">Connect Serial</button>
    <button id="start">Start Loop</button>
    <script type="module">
        import { DefaultController, HEIGHT, WIDTH } from 'led-matrix-controllers';

        const fpsCounter = document.getElementById('fps');

        const controller = new DefaultController();

        let frames = 0;
        let t0 = Date.now();

        document.getElementById('connect').onclick = (e) => {
            controller.connect();
            e.target.disabled = true;
        };

        document.getElementById('start').onclick = () => {
            frames = 0;
            t0 = Date.now();
            loop();
        };

        async function loop() {
            frames++;
            fpsCounter.innerText = `FPS=${1000 * frames / (Date.now() - t0)}`;
            await randomNoise();
            requestAnimationFrame(loop);
        }

        async function randomNoise() {
            await controller.draw(
                Array.from({ length: HEIGHT }, (_, i) =>
                    Array.from({ length: WIDTH }, (_, j) =>
                        Math.random() > 0.75 ? 1 : 0
                    )
                )
            );
        }

        async function gradient() {
            await controller.drawGrayscale(
                Array.from({ length: HEIGHT }, (_, i) =>
                    Array.from({ length: WIDTH }, (_, j) =>
                        ((i + j + Date.now() / 50) % HEIGHT) / HEIGHT
                    )
                )
            );
        }
    </script>
</body>
</html>
